@model JobListingSite.Data.Entities.Offer
@{
    ViewData["Title"] = "Job Details";
    Layout = "_Layout";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    body {
        background: linear-gradient(135deg, #43cea2, #185a9d);
        font-family: 'Segoe UI', sans-serif;
    }

    .details-card {
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        padding: 2.5rem;
        max-width: 700px;
        width: 100%;
        animation: fadeInUp 0.6s ease;
    }

    .job-header {
        border-bottom: 1px solid #ccc;
        margin-bottom: 1rem;
    }

    .job-title {
        font-weight: 700;
        font-size: 1.6rem;
        color: #185a9d;
    }

    .job-meta {
        font-style: italic;
        color: #555;
    }

    .job-description {
        margin-top: 1.5rem;
        line-height: 1.6;
    }

    .apply-btn, .back-btn, .company-btn, .btn-gradient {
        background: linear-gradient(to right, #28a745, #43cea2);
        border: none;
        color: white;
        font-weight: 500;
        padding: 10px 24px;
        border-radius: 8px;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .apply-btn:hover,
    .back-btn:hover,
    .company-btn:hover,
    .btn-gradient:hover {
        background: linear-gradient(to right, #43cea2, #28a745);
        color: white;
        box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        transform: translateY(-2px);
    }

    .button-row {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 2rem;
    }

    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(25px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@media (max-width: 576px) {
        .button-row {
            flex-direction: column;
            align-items: center;
        }

        .apply-btn, .back-btn, .company-btn, .btn-gradient {
            width: 100%;
            text-align: center;
        }
    }
</style>

<div class="container py-5">
    <div class="details-card mx-auto">
        <div class="job-header">
            <h2 class="job-title">
                <i class="fas fa-briefcase me-2"></i>@Model.Title
            </h2>
            <p class="job-meta">
                <i class="fas fa-building me-1"></i> @Model.Company?.CompanyProfile?.CompanyName |
                <i class="fas fa-tag me-1"></i> @Model.Category?.Name |
                <i class="fas fa-clock me-1"></i> Posted on @Model.CreatedAt.ToShortDateString()
            </p>
        </div>

        <div class="job-description">
            <h5><i class="fas fa-info-circle me-2"></i>Job Description</h5>
            <p>@Model.Description</p>
        </div>

        <div class="button-row">
            @if (User.Identity != null && User.Identity.IsAuthenticated && !(ViewData["IsCompany"] as bool? ?? false))
            {
                <form asp-action="Apply" asp-controller="Job" method="post" id="applyForm" class="d-inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="jobId" value="@Model.OfferId" />
                    <button type="submit" id="applyButton" class="apply-btn">
                        <i class="fas fa-paper-plane me-1"></i> Apply Now
                    </button>
                </form>
            }
            else if (!User.Identity?.IsAuthenticated ?? false)
            {
                var returnUrl = Url.Action("Details", "Job", new { id = Model.OfferId });

                <a asp-area="Identity" asp-page="/Account/Register" asp-route-returnUrl="@returnUrl" class="company-btn">
                    <i class="fas fa-user-plus me-2"></i> Register to Apply
                </a>
                <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@returnUrl" class="company-btn">
                    <i class="fas fa-sign-in-alt me-2"></i> Login
                </a>
            }

            @if (Model.Company?.CompanyProfile != null)
            {
                <a asp-controller="Company" asp-action="Profile" asp-route-id="@Model.Company.Id" asp-route-returnTo="@Url.Action("Details", "Job", new { id = Model.OfferId })" class="company-btn">
                    <i class="fas fa-building me-2"></i> View Company
                </a>
            }

            @if (User.Identity?.IsAuthenticated == true && (ViewData["IsCompany"] as bool? ?? false))
            {
                <a href="~/Company/ManageJobs" class="btn-gradient" title="Go to your posted jobs">
                    <i class="fas fa-arrow-left me-1"></i> Back to Manage Jobs
                </a>
            }

            <a asp-controller="Job" asp-action="Browse" class="back-btn">
                <i class="fas fa-arrow-left me-2"></i> Back to Listings
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const successMessage = @Html.Raw(Json.Serialize(TempData["SuccessMessage"] ?? ""));
        const warningMessage = @Html.Raw(Json.Serialize(TempData["WarningMessage"] ?? ""));
        const errorMessage = @Html.Raw(Json.Serialize(TempData["ErrorMessage"] ?? ""));

        if (successMessage.trim()) {
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: successMessage,
                toast: true,
                timer: 3000,
                timerProgressBar: true,
                position: 'top-end',
                showConfirmButton: false
            });
        } else if (warningMessage.trim()) {
            Swal.fire({
                icon: 'warning',
                title: 'Warning!',
                text: warningMessage,
                toast: true,
                timer: 3000,
                timerProgressBar: true,
                position: 'top-end',
                showConfirmButton: false
            });
        } else if (errorMessage.trim()) {
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: errorMessage,
                toast: true,
                timer: 3000,
                timerProgressBar: true,
                position: 'top-end',
                showConfirmButton: false
            });
        }

        const applyForm = document.getElementById('applyForm');
        const applyButton = document.getElementById('applyButton');

        if (applyForm && applyButton) {
            applyForm.addEventListener('submit', function (e) {
                e.preventDefault();

                Swal.fire({
                    title: 'Confirm Apply?',
                    text: "Do you want to apply for this job?",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Apply!',
                    backdrop: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        applyButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Applying...`;
                        applyButton.disabled = true;
                        applyForm.submit();
                    }
                });
            });
        }
    });
</script>
